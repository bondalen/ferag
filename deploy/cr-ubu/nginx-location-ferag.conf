# Добавить в /etc/nginx/sites-available/ontoline.ru
# внутри блока server { listen 443 ssl ... }
# Порядок важен: /ferag/api/ и /ferag/ws/ — до /ferag/

    # ===== FERAG APPLICATION =====

    # Backend API
    location /ferag/api/ {
        proxy_pass http://127.0.0.1:47821/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
    }

    # WebSocket (статусы задач в реальном времени)
    location /ferag/ws/ {
        proxy_pass http://127.0.0.1:47821/ws/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Frontend SPA (Vue, fallback на index.html)
    location /ferag/ {
        alias /var/www/ferag/;
        try_files $uri $uri/ /ferag/index.html;
    }

    location /ferag {
        alias /var/www/ferag;
        index index.html;
        try_files $uri $uri/ /ferag/index.html;
    }
