# Задачи проекта ferag

Задачи выведены из чата `26-0201_chat.txt`. Статус обновляется по мере выполнения.

**Условные обозначения статуса:**
- `[ ]` — не начато
- `[~]` — в работе
- `[x]` — выполнено
- `[-]` — отложено / отменено

---

## Блок 1: Подготовка железа и ОС

| ID | Задача | Статус | Примечание / чат |
|----|--------|--------|------------------|
| 1.1 | Сборка/подключение мини-ПК GMKtec NucBox K8 Plus, установка ОЗУ/SSD | [x] | Чат: выбор железа |
| 1.2 | Настройка BIOS: выделить 8 ГБ под iGPU (VRAM) | [x] | Чат: проверка в Диспетчере задач — GPU 0, NPU 0 |
| 1.3 | Установка Windows 11 (чистая) | [x] | Чат: установка без LAN по наклейке GMKtec |
| 1.4 | Установка драйверов чипсета AMD (в т.ч. NPU) | [x] | Чат: NPU 0 появился в списке |
| 1.5 | Настроить Wi‑Fi: драйвер для RZ616 (MediaTek MT7922) | [x] | Чат: драйвер не Intel; ID PCI VEN_14C3&DEV_0616; драйвер с сайта / USB-модем |
| 1.6 | Установить драйверы Bluetooth и Ethernet (Realtek 2.5G) | [~] | Чат: жёлтые значки; пакет GMKtec / точечные драйверы |
| 1.7 | Синхронизация времени (часовой пояс Москва/Петербург) | [x] | Чат: кнопка «Синхронизировать» в настройках времени |
| 1.8 | Настройка питания: сон «Никогда» при питании от сети, режим «Максимальная производительность» | [x] | Чат: для долгих расчётов индексации |
| 1.9 | Аудио: при необходимости — драйвер AMD/Realtek из папки производителя | [~] | Чат: «Устройство с поддержкой High Definition Audio», ручная инъекция .inf |
| 1.10 | Удалить лишние Intel-драйверы (PROSet/Wireless, Bluetooth), если ставились по ошибке | [ ] | Чат: очистка «зоопарка» драйверов |

---

## Блок 2: Разделение сред (Windows / Linux)

| ID | Задача | Статус | Примечание / чат |
|----|--------|--------|------------------|
| 2.1 | Установить WSL2, дистрибутив Ubuntu | [x] | Чат: база для ferag |
| 2.2 | Перенести WSL на диск D: (export/import, .wslconfig) | [x] | Чат: данные и диск не на C: |
| 2.3 | Создать/настроить .wslconfig (лимит памяти для WSL), перезапуск WSL | [x] | Файл создан: C:\Users\Admin\.wslconfig; применить: wsl --shutdown |
| 2.4 | Переименовать хост: Windows (например, AI-Station / NucBox-K8), WSL — nb-win (или ai-lab) | [x] | Чат: hostnamectl, /etc/hosts |

---

## Блок 3: Локальная LLM и среда разработки

| ID | Задача | Статус | Примечание / чат |
|----|--------|--------|------------------|
| 3.1 | Установить Ollama (Windows), скачать модель (напр. Llama 3.2) | [x] | Чат: проверка «первого ИИ» |
| 3.2 | Установить Cursor, расширение WSL, подключиться к Ubuntu | [x] | Чат: WSL: Ubuntu в углу |
| 3.3 | Открыть папку проекта в Cursor: `/home/alex/projects/ferag` | [x] | Чат: File → Open Folder, путь в WSL |
| 3.4 | Установить команду cursor/code в PATH (Shell Command: Install 'cursor' in PATH) | [x] | Чат: cursor --version, cursor hello |
| 3.5 | Настроить Cursor: OpenAI-совместимый API → localhost:11434 (Ollama), модель llama3.2 | [x] | Чат: Settings → Models, Override Base URL |
| 3.6 | Установить Cursor Agent CLI (Install CLI в предложении Cursor) | [x] | Чат: Installation Complete |

---

## Блок 4: Инфраструктура БД (Docker)

| ID | Задача | Статус | Примечание / чат |
|----|--------|--------|------------------|
| 4.1 | Установить Docker Desktop для Windows, движок WSL 2 | [x] | Чат: отложено («глинтвейн и баранина») |
| 4.2 | Включить WSL Integration для Ubuntu в настройках Docker | [x] | После 4.1 |
| 4.3 | Проверить `docker ps` из терминала Cursor (Ubuntu) | [x] | После 4.2 |
| 4.4 | Установить PostgreSQL + Apache AGE + pgvector (VectorGraph или самостоятельно) | [ ] | docs/project/PROJECT-002.md, разд. 5.4; VectorGraph: https://github.com/QuixiAI/vectorgraph |
| 4.5 | Подключиться к PostgreSQL, проверить расширения AGE и pgvector | [ ] | `docker exec -it ... psql -U postgres`; CREATE EXTENSION age, vector |
| 4.6 | Создать первый граф в Apache AGE | [ ] | `SELECT create_graph('knowledge_graph');` |
| 4.7 | Изучить основы Cypher в Apache AGE | [ ] | Документация: https://age.apache.org/age-manual/master/intro/cypher.html |
| 4.8 | Создать тестовые узлы и рёбра (проверка работы AGE) | [ ] | Cypher: CREATE (p:Person)-[:KNOWS]->(p2:Person) |
| 4.9 | Протестировать pgvector: создать таблицу с эмбеддингами, векторный поиск | [ ] | CREATE TABLE test (embedding vector(1536)); поиск по cosine |
| 4.10 | Установить Apache Jena Fuseki (источник истины для онтологии с OWL reasoning) | [ ] | docs/project/PROJECT-002.md, разд. 5.4; критично для Schema Induction |

---

## Блок 5: Аккаунт и резервное копирование

| ID | Задача | Статус | Примечание / чат |
|----|--------|--------|------------------|
| 5.1 | Войти в аккаунт Microsoft (привязка лицензии, настройки) | [ ] | Чат: «цифровая лицензия», OneDrive |
| 5.2 | Настроить OneDrive: исключить D:\AI_MODELS, WSL; синхронизировать только D:\projects (или аналог) | [ ] | Чат: не тянуть 40 ГБ моделей и vhdx в облако |

---

## Блок 6: MS GraphRAG, Schema Induction и онтология

### Подготовка (Этап 1: Базовая онтология)

| ID | Задача | Статус | Примечание |
|----|--------|--------|------------|
| 6.1 | Создать базовую онтологию через Pydantic-схемы | [ ] | src/ontology/schema.py: классы Person, Organization, Event; отношения worksFor, participatedIn |
| 6.2 | Реализовать валидатор триплетов (ламинарные/турбулентные) | [ ] | src/ontology/validator.py: проверка domain/range, фильтрация |

### MS GraphRAG (Тезис: извлечение триплетов)

| ID | Задача | Статус | Примечание |
|----|--------|--------|------------|
| 6.3 | Установить MS GraphRAG | [ ] | `pip install graphrag`; инициализация: `graphrag init --root ~/projects/ferag` |
| 6.4 | Настроить MS GraphRAG для работы с Ollama | [ ] | settings.yaml: llm.model = ollama:llama3.3:70b-q4_k_m, api_base = localhost:11434 |
| 6.5 | Подготовить тестовый корпус текстов (10-20 документов) | [ ] | data/raw/: научные статьи, документация, диалоги |
| 6.6 | Запустить первую индексацию MS GraphRAG | [ ] | `graphrag index --root ~/projects/ferag`; 20-40 мин на 10-20 док |
| 6.7 | Изучить результаты: entities, relationships, communities | [ ] | data/graphrag/output/*.parquet: анализ структуры |
| 6.8 | Загрузить триплеты из MS GraphRAG в Apache Jena Fuseki (staging dataset) | [ ] | Python: relationships.parquet → RDF (Turtle) → Fuseki /ferag-staging |

### Schema Induction (Антитезис: извлечение онтологии)

| ID | Задача | Статус | Примечание |
|----|--------|--------|------------|
| 6.9 | Реализовать скрипт Schema Induction (LLM + communities) | [ ] | src/schema_induction/extractor.py: анализ триплетов + communities → OWL |
| 6.10 | Запустить Schema Induction на тестовых данных | [ ] | Llama 3.3 70B Q4_K_M, 2-4 часа; результат: ontology.owl |
| 6.11 | Сохранить извлечённую онтологию в Apache Jena Fuseki | [ ] | Fuseki: dataset /ferag-ontology (OWL/RDF с reasoning) |
| 6.12 | Визуализировать онтологию в WebProtégé | [ ] | Экспорт RDF → импорт в https://webprotege.stanford.edu/ |

### Синтез (интеграция знаний)

| ID | Задача | Статус | Примечание |
|----|--------|--------|------------|
| 6.13 | Реализовать сравнение онтологий (SPARQL + inference) | [ ] | src/synthesis/comparator.py: новые классы, свойства (с использованием rdfs:subClassOf inference) |
| 6.14 | Реализовать классификацию триплетов (ламинарные/турбулентные) | [ ] | src/synthesis/classifier.py: валидация по онтологии |
| 6.15 | Реализовать очистку аномалий (Graph Validation) | [ ] | SPARQL: поиск нарушений domain/range, удаление |
| 6.16 | Реализовать синтез интегрированной онтологии | [ ] | src/synthesis/integrator.py: merge онтологий |
| 6.17 | Обновить production DB (Apache Jena Fuseki) | [ ] | /ferag-prod dataset ← интегрированная онтология + все триплеты (с активным reasoning) |

#### Перспектива: LLM-ревизия слияния (подлежит реализации позже)

| ID | Задача | Статус | Примечание |
|----|--------|--------|------------|
| 6.23 | Реализовать LLM-ревизию слияния онтологий | [ ] | Вызов LLM для неочевидных соответствий (новый класс X = эквивалент Y / подкласс / отдельно); опора на примеры из триплетов; при сомнении — запрос пользователю. |
| 6.24 | Реализовать LLM-ревизию слияния триплетов | [ ] | Коллизии (описания, противоречащие факты), кандидаты на смысловое дублирование; передача LLM выдержек из исходных текстов; опционально веб; при сомнении — обращение к пользователю. Протокол решений (лог/таблица) для воспроизводимости. |

### Проекции и эксплуатация

**Приоритет:** диалог с LLM по графу достигнут (6.21, 6.22 выполнены — контекст по вопросу, вариант A). Далее по приоритету: проекции (6.18–6.20), семантический поиск, история диалога.

| ID | Задача | Статус | Примечание |
|----|--------|--------|------------|
| 6.18 | Реализовать синхронизацию: MillenniumDB → PostgreSQL + AGE | [ ] | src/sync/rdf_to_pg.py: RDF → Cypher конвертация; после RAG/диалога |
| 6.19 | Создать векторные индексы документов (pgvector) | [ ] | Эмбеддинги → pgvector для семантического поиска |
| 6.20 | Создать реляционные проекции (Materialized Views) | [ ] | PostgreSQL: CREATE MATERIALIZED VIEW org_stats AS ... |
| 6.21 | Реализовать RAG для диалога (Hybrid Retriever) | [x] | Планы 26-0213-1049 и 26-0215-1600: запрос к ferag-prod (SPARQL) + контекст по вопросу (вариант A) или фиксированный (--fixed) → LLM → ответ. graphrag-test/rag_chat.py, rag_context.py, rag_llm.py. |
| 6.22 | Протестировать диалог: задать вопрос → получить ответ | [x] | Проверка пройдена: вопросы «Кто такой Alice Smith?», «Где работает Bob Johnson?», «Что такое DataCorp?», fallback при «абракадабра»; ответ опирается на граф. Резюме: docs/chats/26-0215-1600_plan_resume.md |

---

---

## Блок 7: Визуализация и картография (перспектива)

| ID | Задача | Статус | Примечание / чат |
|----|--------|--------|------------------|
| 7.1 | Установить QGIS для работы с картографическими данными | [ ] | Чат: визуализация геопривязанных сущностей |
| 7.2 | Реализовать геокодирование сущностей из графа (Location → координаты) | [ ] | Интеграция графа и карт |
| 7.3 | Визуализация событий на карте с временной осью | [ ] | Пространственно-временной анализ |

---

## Блок 9: Веб-приложение ferag

Архитектура согласована 2026-02-15. Подробности: [docs/project/PROJECT-004.md](../project/PROJECT-004.md). Операционные файлы: [deploy/](../../deploy/).

| ID | Задача | Статус | Примечание |
|----|--------|--------|------------|
| 9.1 | Реализовать `code/backend/` — FastAPI (auth, CRUD, WebSocket) | [x] | Выполнено: auth, rags, tasks. WebSocket, /upload, /chat — в Чате 2. |
| 9.2 | Написать `code/backend/Dockerfile` — FastAPI + Redis + supervisord в одном образе | [ ] | python:3.11-slim, apt redis-server supervisor, supervisord.conf; PROJECT-004.md разд. 8 |
| 9.3 | Реализовать `code/worker/` — Celery (GraphRAG + RAG задачи) | [ ] | Брокер: redis://10.7.0.1:47379/0; задачи: build_graph, run_rag; доступ к Fuseki и PostgreSQL |
| 9.4 | Написать `code/worker/Dockerfile` | [ ] | Включить graphrag-test/ зависимости; host.docker.internal для LM Studio :41234 |
| 9.5 | Реализовать `code/frontend/` — Vue 3 SPA | [ ] | Vite: base '/ferag/'; страницы: login, список RAG, загрузка файлов, диалог, приглашения |
| 9.6 | Дополнить `deploy/nb-win/init-db.sh` — расширения AGE и pgvector | [ ] | CREATE EXTENSION age, vector; LOAD 'age'; SELECT create_graph('knowledge_graph') |
| 9.7 | Собрать Vue и разложить в `/var/www/ferag/` на cr-ubu | [ ] | npm run build → scp/rsync dist/* на cr-ubu; права www-data |
| 9.8 | Настроить Nginx на cr-ubu | [ ] | sudo cp deploy/cr-ubu/nginx-location-ferag.conf /etc/nginx/snippets/ferag.conf; include в vhost |
| 9.9 | Первый сквозной запуск и проверка | [ ] | login → создать RAG → загрузить файл → вопрос → LLM-ответ |
| 9.10 | (опц.) CI/CD | [ ] | GitHub Actions или аналог: build + deploy code/frontend, docker-compose up --build code/backend |

---

## Блок 8: Масштабирование (Этап 2, планируется)

| ID | Задача | Статус | Примечание / чат |
|----|--------|--------|------------------|
| 8.1 | Приобрести второй SSD M.2 NVMe (1-2 ТБ) | [ ] | Чат: для Fedora 43, отдельный диск |
| 8.2 | Установить Fedora 43 (dual-boot) | [ ] | Чат: нативная производительность Linux |
| 8.3 | Настроить общий раздел для моделей (D:\AI_MODELS → /mnt/models) | [ ] | Единое хранилище для обеих ОС |
| 8.4 | Перенести тяжёлые вычисления на Fedora (индексация больших корпусов) | [ ] | Разделение функций: Windows = GUI, Fedora = вычисления |
| 8.5 | (Опционально) Подключить eGPU через OCuLink | [ ] | Чат: RTX 4070 Ti / 4080, ускорение в 3-5 раз |

---

## Сводка по статусам

| Статус | Количество |
|--------|------------|
| [x] Выполнено | 19 |
| [~] В работе | 2 |
| [ ] Не начато | 31 |
| [-] Отложено | 0 |

*Последнее обновление: 2026-02-15. Добавлен Блок 9 (веб-приложение, 10 задач). Архитектура согласована: [PROJECT-004.md](../project/PROJECT-004.md).*
