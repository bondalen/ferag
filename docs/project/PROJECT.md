# Проектная документация: ferag

Общее представление о проекте. Детали — в томах [PROJECT-001](PROJECT-001.md), [PROJECT-002](PROJECT-002.md), [PROJECT-003](PROJECT-003.md).

---

## 1. Назначение и философская основа

**ferag** — лабораторный проект по построению локальной системы графового RAG (Retrieval-Augmented Generation) на основе текста. Цель: превращать текстовые корпуса в структурированный граф знаний (онтологию) и получать ответы на сложные вопросы, опираясь на связи между сущностями.

### 1.1. Диалектический подход: Тезис — Антитезис — Синтез

- **Тезис:** Новый корпус → LLM извлекает сущности и связи → неорганизованный массив триплетов.
- **Антитезис:** Существующая онтология (классы, типы связей) как схема для классификации.
- **Синтез:** Триплеты делятся на ламинарные (вписываются в схему) и турбулентные (требуют изменения онтологии); интеграция → обогащённая онтология становится новым Антитезисом для следующего цикла.

### 1.2. Эксплуатация и готовность

**Эксплуатация** — ответы на вопросы пользователя по уже синтезированной онтологии (диалог с LLM по графу).

**Готовность рабочего процесса:** процедура считается готовой (хотя бы вчерне), когда возможен **диалог с LLM по сохранённым данным** (RAG): вопрос → выборка контекста из графа → ответ LLM. Цикл построения графа может быть готов отдельно; приоритет — сначала диалог, затем проекции и улучшения.

---

## 2. Цели и результаты

| Цель | Описание |
|------|----------|
| Локальный запуск LLM | Запуск больших языковых моделей на своём ПК без облачных API. |
| Графовый RAG | Построение графа знаний из текста и ответы на сложные/глобальные вопросы. |
| Онтология как ядро | Создание и развитие онтологии, структурирующей извлечённые триплеты. |
| Диалектический цикл | Новые данные → синтез → обогащённая онтология → цикл. |
| Визуализация | Инструменты для графа и онтологий (Protégé, QGIS). |
| Воспроизводимая среда | Windows + WSL2 + Cursor + Ollama + Docker. |

---

## 3. Целевая платформа и стек (кратко)

Железо и детали платформы: [PROJECT-001](PROJECT-001.md).

**Платформа:** GMKtec NucBox K8 Plus (Ryzen 7 8845HS, 64 ГБ ОЗУ, iGPU Radeon 780M 8 ГБ).  
**Стек:** Windows 11 + WSL2 (Ubuntu), Cursor, Ollama / LM Studio, Docker, Apache Jena Fuseki (RDF/SPARQL, онтология), MS GraphRAG, LlamaIndex (Schema Induction). PostgreSQL + AGE + pgvector — в перспективе (проекции, RAG).

---

## 4. Архитектура цикла (схема)

```
Тексты → MS GraphRAG (триплеты, communities) → Fuseki staging
    → Schema Induction (LLM) → онтология → Fuseki ontology
    → Слияние онтологий и триплетов → ferag-prod
    → (перспектива) Проекции: PostgreSQL/AGE/pgvector → RAG/диалог
```

Источник истины: **Apache Jena Fuseki** (RDF/OWL + reasoning). Детали БД и развёртывания: [PROJECT-002](PROJECT-002.md).

---

## 5. Структура проекта

```
ferag/
├── docs/
│   ├── project/          # Проектная документация (PROJECT.md + тома)
│   ├── tasks/            # Задачи (TASKS.md)
│   ├── journal/          # Журнал (JOURNAL.md + тома)
│   └── chats/            # Планы и резюме чатов
├── graphrag-test/        # GraphRAG, конвертация в RDF, слияние, скрипты
├── graphrag-test-cycle2/ # Второй цикл (корпус 2)
├── deploy/               # Конфигурации развёртывания (cr-ubu, nb-win)
├── 26-0201_chat.txt      # Исходный чат-источник решений
└── README.md
```

---

## Текущий статус и следующий рубеж (15.02.2026)

- **Цикл построения графа** выполнен по плану 26-0210-1500: Fuseki, GraphRAG, Schema Induction, два цикла, слияние онтологий и триплетов, ferag-prod (756 триплетов). Резюме: [docs/chats/26-0210-1500_plan_resume.md](../chats/26-0210-1500_plan_resume.md).
- **Минимальный RAG/диалог** достигнут по плану 26-0213-1049: вопрос → контекст из графа → LLM → ответ. Резюме: [docs/chats/26-0213-1049_plan_resume.md](../chats/26-0213-1049_plan_resume.md).
- **Вариант A (контекст по словам вопроса)** реализован по плану 26-0215-1600: ключевые слова из вопроса → SPARQL по сущностям и связям → сборка контекста; при пустой выборке — fallback на фиксированную выборку. По умолчанию `rag_chat.py` использует контекст по вопросу. Резюме: [docs/chats/26-0215-1600_plan_resume.md](../chats/26-0215-1600_plan_resume.md).
- **Архитектура веб-приложения** спроектирована (2026-02-15): двухмашинная топология (cr-ubu + nb-win + WireGuard), стек FastAPI/Vue/Celery/Redis, маршрутизация под `/ferag/`, один контейнер на cr-ubu. Реализация не начата. Подробности: [PROJECT-004](PROJECT-004.md).
- **Готовность рабочего процесса:** диалог с LLM по сохранённым данным (RAG) достигнут; ретривер привязан к словам вопроса. Следующий рубеж: веб-приложение (Блок 9 в TASKS.md), затем проекции (PostgreSQL/AGE/pgvector).
- **Чат по RAG в веб-приложении:** сейчас одношаговый (вопрос → RAG-контекст → ответ), история не сохраняется. Запланировано: сохранение истории диалога в БД, передача контекста диалога в LLM (скользящее окно), при длинных чатах — сжатие/резюме. Порядок работы и варианты: [PROJECT-004-chat-dialogue](PROJECT-004-chat-dialogue.md).

---

## Ссылки

- **Задачи:** [docs/tasks/TASKS.md](../tasks/TASKS.md)
- **Журнал:** [docs/journal/JOURNAL.md](../journal/JOURNAL.md)
- **Тома проектной документации:**
  - [PROJECT-001](PROJECT-001.md) — железо и платформа (конфигурация, dual-boot, eGPU)
  - [PROJECT-002](PROJECT-002.md) — БД, архитектура хранения, GraphRAG/Schema Induction, PostgreSQL/RAG
  - [PROJECT-003](PROJECT-003.md) — перспективы (LLM-ревизия слияния, этапы развития), источники решений
  - [PROJECT-004](PROJECT-004.md) — веб-приложение и развёртывание (FastAPI, Vue, Celery, двухмашинная топология)
  - [PROJECT-004-chat-dialogue](PROJECT-004-chat-dialogue.md) — диалог по RAG (чат): текущее состояние, порядок доработки (история, контекст, сжатие)
- **Быстрый деплой:** порядок действий AI-агента при выкатке на cr-ubu — [PROJECT-004, п. 11](PROJECT-004.md), [deploy/DEPLOYMENT_SUMMARY.md](../../deploy/DEPLOYMENT_SUMMARY.md), правило [.cursor/rules/deploy-cr-ubu-ssh.mdc](../../.cursor/rules/deploy-cr-ubu-ssh.mdc).
